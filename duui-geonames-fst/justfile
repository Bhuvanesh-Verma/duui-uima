version := "0.3.3"

default version=version:
    just single "{{version}}"
    just eu "{{version}}"

single version=version variant="de":
    just build "{{version}}" "{{variant}}"
    just tag "{{version}}" "{{variant}}"
    just push "{{version}}" "{{variant}}"

build version=version variant="de":
    docker build -f src/main/docker/single.Dockerfile -t duui-geonames-fst/{{variant}}:{{version}} --build-arg COUNTRY={{uppercase(variant)}} .
    docker tag duui-geonames-fst/{{variant}}:{{version}} duui-geonames-fst/{{variant}}:latest

tag version=version variant="de":
    docker tag duui-geonames-fst/{{variant}}:{{version}} docker.texttechnologylab.org/duui-geonames-fst/{{variant}}:{{version}}
    docker tag duui-geonames-fst/{{variant}}:{{version}} docker.texttechnologylab.org/duui-geonames-fst/{{variant}}:latest

push version=version variant="de":
    docker push docker.texttechnologylab.org/duui-geonames-fst/{{variant}}:{{version}}
    docker push docker.texttechnologylab.org/duui-geonames-fst/{{variant}}:latest

eu version=version:
    docker build -f src/main/docker/eu.Dockerfile -t duui-geonames-fst/eu:{{version}} .
    docker tag duui-geonames-fst/eu:{{version}} duui-geonames-fst/eu:latest
    just tag "{{version}}" "eu"
    just push "{{version}}" "eu"

europe version=version:
    docker build -f src/main/docker/europe.Dockerfile -t duui-geonames-fst/europe:{{version}} .
    docker tag duui-geonames-fst/europe:{{version}} duui-geonames-fst/europe:latest
    just tag "{{version}}" "europe"
    just push "{{version}}" "europe"

europe-central version=version:
    docker build -f src/main/docker/europe-central.Dockerfile -t duui-geonames-fst/europe-central:{{version}} .
    docker tag duui-geonames-fst/europe-central:{{version}} duui-geonames-fst/europe-central:latest
    just tag "{{version}}" "europe-central"
    just push "{{version}}" "europe-central"
